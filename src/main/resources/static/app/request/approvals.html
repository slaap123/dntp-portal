<!-- If in 'Approval' status and user type 'palga' or 'scientific_council' -->
<div ng-controller="ApprovalController">

    <h3>{{'Approval by the scientific council'|translate}}</h3>
    <hr>

    <h4>{{'Votes'|translate}}</h4>
    <hr>

    <!-- Status -->
    <div class="row">
        <label class="control-label col-sm-3">{{ 'Votes' | translate }}</label>
        <div class="col-sm-8">
            <div class="panel panel-default">
                <div class="panel-body">
                    {{size(request.approvalVotes)}} votes.
                </div>
            </div>
            <div class="panel panel-default" ng-repeat="(user_id, vote) in request.approvalVotes">
                <div class="panel-body">
                    <span ng-if="vote.value=='ACCEPTED'"><i class="glyphicon glyphicon-ok-circle"></i></span>
                    <span ng-if="vote.value=='REJECTED'"><i class="glyphicon glyphicon-ban-circle"></i></span>
                    <span ng-if="vote.value=='NONE'"><i class="glyphicon glyphicon-question-sign"></i></span>
                    {{vote.value}} &nbsp;
                    <small ng-if="getName(vote.creator)">({{getName(vote.creator)}})</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Add vote -->
    <div ng-if="globals.currentUser.roles.indexOf('scientific_council') != -1" class="row" ng-class="">
        <div class="col-sm-8">
            <!-- {{request.approvalVotes[globals.currentUser.userid].value}} -->
            <button class="btn btn-default {{request.approvalVotes[globals.currentUser.userid].value=='ACCEPTED'?'active':''}}"
                    type="button" title="{{'Accepted'|translate}}"
                    ng-click="updateVote(request, 'ACCEPTED')"
                    ng-if="!editComment.id">
                <span><i class="glyphicon glyphicon-ok-circle"></i></span>
                {{'Accepted'|translate}}
            </button>
            <button class="btn btn-default {{request.approvalVotes[globals.currentUser.userid].value=='REJECTED'?'active':''}}"
                    type="button" title="{{'Rejected'|translate}}"
                    ng-click="updateVote(request, 'REJECTED')"
                    ng-if="!editComment.id">
                <span><i class="glyphicon glyphicon-ban-circle"></i></span>
                {{'Rejected'|translate}}
            </button>
        </div>
    </div>
    <br>

    <h4>{{'Discussion'|translate}}</h4>
    <hr>
    <ul class="list-group">
        <li class="list-group-item" ng-repeat="comment in request.approvalComments">
            <p>
            <div ng-show="!approval_comment_edit_visibility[comment.id]">{{comment.contents}}</div>
            <div ng-show="approval_comment_edit_visibility[comment.id]">
                               <textarea name="commentText" placeholder="{{'Add comment'|translate}}"
                                         ng-model="comment.contents">
                               </textarea>
                <button class="btn btn-default" type="button" title="{{'Update comment'|translate}}"
                        ng-click="updateComment(request, comment)">
                    {{'Update comment'|translate}}
                </button>
            </div>
                <span class="pull-right" ng-if="globals.currentUser.id==comment.creator.id">
                <span class="btn-group btn-group-xs">
                    <button class="btn btn-info {{commentEditVisibility[comment.id] ? 'active' : ''}}" type="button"
                            title="Edit"
                            ng-click="commentEditVisibility[comment.id] = 1">
                        <span><i class="glyphicon glyphicon-pencil"></i></span>
                    </button>
                    <button class="btn btn-danger" type="button" title="Delete"
                            ng-click="removeApprovalComment(comment)">
                        <span><i class="glyphicon glyphicon-remove-circle"></i></span>
                    </button>
                </span>
                </span>
            </p>
            <p>
                <small>
                    <span><i class="glyphicon glyphicon-user"></i></span>
                    <em>{{getName(comment.creator)}}</em>
                    &nbsp;
                    <span><i class="glyphicon glyphicon-time"></i></span>
                    <span>{{comment.timeCreated | date: 'EEE dd MMMM yyyy  HH:mm'}}</span>
                    <span ng-if="comment.timeEdited != comment.timeCreated">(Last edited: {{comment.timeEdited | date: 'EEE dd MMMM yyyy  HH:mm'}})</span>
                </small>
            </p>
        </li>
    </ul>

    <!-- Add approval comment -->
    <div class="row" ng-class="">
        <div class="col-sm-12">
            <input type="hidden" ng-model="approvalComment.processInstanceId" value="{{request.processInstanceId}}">
                            <textarea class="form-control" id="commentText" name="commentText"
                                      placeholder="{{'Add comment'|translate}}"
                                      ng-model="approvalComment.contents">
                            </textarea>
        </div>
    </div>
    <div class="row" ng-class="">
        <div class="col-sm-12 text-justify">
            <br>
            <button class="btn btn-default" type="button" title="{{'Add comment'|translate}}"
                    ng-click="addApprovalComment(request, approvalComment)"
                    ng-if="!approvalComment.id">
                {{'Add comment'|translate}}
            </button>
            <button class="btn btn-default" type="button" title="{{'Update comment'|translate}}"
                    ng-click="updateApprovalComment(request, approvalComment)"
                    ng-if="approvalComment.id">
                {{'Update comment'|translate}}
            </button>
        </div>
    </div>
    <br>

</div> <!-- endif 'Approval' status and user type 'palga' or 'scientific_council' -->
